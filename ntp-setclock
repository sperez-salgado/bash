#!/usr/bin/openrc-run 
# Shebang might be different in other distros (e.g., /sbin/openrc-run in devuan)
# Salvador PÃ©rez-Salgado - sep 29, 2021
# Distributed under the terms of the GNU General Public License v2
# Needs ntpdate

depend() {
	after net
}

start() {
	ebegin "Setting clock via the NTP client"
	$(NTP=0; \
	while [ $NTP == 0 ]; \
	 	do \
			if ping -c 1 -n -w 1 8.8.8.8 &> /dev/null; then \
				NTP=1 && ntpdate -b -s 0.gentoo.pool.ntp.org && einfo "[ntp] Done!. Current date is $(date)."; \
			else sleep 5; \
			fi; \
	done) &
	eend
}

stop(){
	einfo "[ntp] All done"
}
